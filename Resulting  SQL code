

SELECT
 id as account_id,
 COUNT(DISTINCT ev.id_message) as visit_cnt,
 MAX(DATE_ADD(s.date, INTERVAL eo.open_date DAY)) as last_visit_date,
 COUNT(DISTINCT eo.id_message)*10 as revenue
from `DA.account` as a
left join `DA.email_open` eo
on a.id=eo.id_account
left join `DA.email_visit` as ev
on a.id=ev.id_account
Left JOIN `DA.account_session` as acs
on a.id=acs.account_id
left join `DA.session` s
on acs.ga_session_id=s.ga_session_id
GROUP BY account_id
having visit_cnt>0 and last_visit_date is not null
